<html lang="en" id="appli"></html>

<script type="importmap">
  {
    "imports": {
      "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
    }
  }
</script>

<script src="https://unpkg.com/navigo@8.11.1/lib/navigo.min.js"></script>
<!--<script src="router.js"></script>-->

<script type="module">
console.log("two_")

import { createApp, ref } from 'vue'

document.addEventListener('DOMContentLoaded', function() {
  const app = document.getElementById('appli');
  const router = new Navigo('/', { hash: false });

  // Charge un fragment HTML et injecte le terme, si présent
  function render(fragment, term = '') {
    fetch(fragment)
      .then(res => res.text())
      .then(html => {
        app.innerHTML = html;
        // Injecte le mot-clé recherché
        app.querySelectorAll('[data-search-term]').forEach(el => {
          el.textContent = decodeURIComponent(term);
        });
      });
  }

  router
    .on('/', () => render('home.html'))
    .on('/about', () => render('about.html'))
    .on('/search', () => render('search.html'))

    .on('/searched/:term+', ({ data }) => render('indeed.html', data.term))
    .notFound(() => render('404.html', window.location.pathname))
    .resolve();

  // Réactive le router sur les liens internes
  document.body.addEventListener('click', e => {
    if (e.target.matches('[data-navigo]')) {
      e.preventDefault();
      router.navigate(e.target.getAttribute('href'));
    }
  });



if(document.getElementById('app')) {

createApp({
  setup() {
    console.log("xhy")
    const priceBTC = ref(null)
    const priceETH = ref(null)
    const priceSOL = ref(null)
    const trendBTC = ref('up')
    const trendETH = ref('up')
    const trendSOL = ref('up')
    const colorBTC = ref('rgb(77, 230, 34)')
    const colorETH = ref('rgb(77, 230, 34)')
    const colorSOL = ref('rgb(77, 230, 34)')

    async function fetchPrice() {
      try {
        const responseBTC = await fetch('https://api.exchange.coinbase.com/products/BTC-EUR/ticker')
        const resultBTC = await responseBTC.json()
        priceBTC.value = resultBTC.price

        const responseETH = await fetch('https://api.exchange.coinbase.com/products/ETH-EUR/ticker')
        const resultETH = await responseETH.json()
        priceETH.value = resultETH.price

        const responseSOL = await fetch('https://api.exchange.coinbase.com/products/SOL-EUR/ticker')
        const resultSOL = await responseSOL.json()
        priceSOL.value = resultSOL.price


        const responseBTC2 = await fetch('https://api.exchange.coinbase.com/products/BTC-EUR/trades?limit=2')
        const resultBTC2 = await responseBTC2.json()

        const responseETH2 = await fetch('https://api.exchange.coinbase.com/products/ETH-EUR/trades?limit=2')
        const resultETH2 = await responseETH2.json()

        const responseSOL2 = await fetch('https://api.exchange.coinbase.com/products/SOL-EUR/trades?limit=2')
        const resultSOL2 = await responseSOL2.json()


        if (resultBTC2[0].price > resultBTC2[1].price) {
          trendBTC.value = 'up';
          colorBTC.value = 'rgb(77, 230, 34)'
        }
        else if (resultBTC2[0].price < resultBTC2[1].price) {
          trendBTC.value = 'down';
          colorBTC.value = 'rgb(216, 16, 16)'
        }
        else if (resultBTC2[0].price == resultBTC2[1].price) {
          trendBTC.value = trendBTC.value
          colorBTC.value = colorBTC.value
        }

        if (resultETH2[0].price > resultETH2[1].price) {
          trendETH.value = 'up';
          colorETH.value = 'rgb(77, 230, 34)'
        }
        else if (resultETH2[0].price < resultETH2[1].price) {
          trendETH.value = 'down';
          colorETH.value = 'rgb(216, 16, 16)'
        }
        else if (resultETH2[0].price == resultETH2[1].price) {
          trendETH.value = trendETH.value
          colorETH.value = colorETH.value
        }

        if (resultSOL2[0].price > resultSOL2[1].price) {
          trendSOL.value = 'up';
          colorSOL.value = 'rgb(77, 230, 34)'
        }
        else if (resultSOL2[0].price < resultSOL2[1].price) {
          trendSOL.value = 'down';
          colorSOL.value = 'rgb(216, 16, 16)'
        }
        else if (resultSOL2[0].price == resultSOL2[1].price) {
          trendSOL.value = trendSOL.value
          colorSOL.value = colorSOL.value
        }
      } catch (error) {
        console.error('Error fetching data:', error)
      }
    }
    
    setInterval(fetchPrice, 1000);
    fetchPrice()
    return { priceBTC, priceETH, priceSOL, trendBTC, trendETH, trendSOL, colorBTC, colorETH, colorSOL }
  }
}).mount('#appHome')
}
});
</script>