<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="./pictures/icon_site.png">
    <title>Finankox</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
    <link rel="stylesheet" href="index.css">
</head>

<nav class="nav_bar">
  <h1>Finankox</h1>
  <img src="./pictures/icon_site.png" class="logo">

  <div id="mySidenav" class="sidenav">
  <a id="closeBtn" href="#" class="close">×</a>
  <ul>
    <li><a href="/" data-navigo>Home</a></li>
    <li><a href="search" data-navigo>Search</a></li>
    <li><a href="about" data-navigo>About</a></li>
  </ul>
</div>

<a href="#" id="openBtn">
  <span class="burger-icon"></span>
  <span class="burger-icon"></span>
  <span class="burger-icon"></span>
</a>
</nav>

<div class="jumped"></div>

<div id="appli"></div>

<script src="https://unpkg.com/navigo@8.11.1/lib/navigo.min.js"></script>
<!--<script src="router.js"></script>-->

<script>
  console.log("two")
var sidenav = document.getElementById("mySidenav");
var openBtn = document.getElementById("openBtn");
var closeBtn = document.getElementById("closeBtn");

openBtn.onclick = openNav;
closeBtn.onclick = closeNav;

/* Set the width of the side navigation to 250px */
function openNav() {
  sidenav.classList.add("active");
}

/* Set the width of the side navigation to 0 */
function closeNav() {
  sidenav.classList.remove("active");
}

;(function() {
  const app = document.getElementById('appli');
  const router = new Navigo('/', { hash: false });

  // Charge un fragment HTML et injecte le terme, si présent
  function render(fragment, term = '') {
    fetch(fragment)
      .then(res => res.text())
      .then(html => {
        app.innerHTML = html;
        // Injecte le mot-clé recherché
        app.querySelectorAll('[data-search-term]').forEach(el => {
          el.textContent = decodeURIComponent(term);
        });
      });
  }

  router
    .on('/', () => render('home.html'))
    .on('/about', () => render('about.html'))
    .on('/search', () => render('search.html'))

    .on('/searched/:term+', ({ data }) => render('indeed.html', data.term))
    .notFound(() => render('404.html', window.location.pathname))
    .resolve();

  // Réactive le router sur les liens internes
  document.body.addEventListener('click', e => {
    if (e.target.matches('[data-navigo]')) {
      e.preventDefault();
      router.navigate(e.target.getAttribute('href'));
    }
  });
})();



function loadPage(pageUrl) {
            fetch(pageUrl)
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const scripts = doc.querySelectorAll('script');

                    // Exécuter les scripts
                    scripts.forEach(script => {
                        if (script.src) {
                            // Si le script a une source externe
                            const newScript = document.createElement('script');
                            newScript.src = script.src;
                            document.body.appendChild(newScript);
                        } else {
                            // Si le script est inline
                            const newScript = document.createElement('script');
                            newScript.textContent = script.textContent;
                            document.body.appendChild(newScript);
                        }
                    });

                    // Insérer le contenu HTML
                    const content = doc.querySelector('body').innerHTML;
                    document.getElementById('content').innerHTML = content;
                })
                .catch(error => console.error('Error loading page:', error));
        }

        // Charger la page par défaut (par exemple, home.html)
        loadPage('home.html');
</script>